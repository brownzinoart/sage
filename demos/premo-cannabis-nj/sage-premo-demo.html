<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sage AI - Powered by Premo Cannabis</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .typing-indicator::after {
            content: '...';
            animation: typing 1.5s steps(4, end) infinite;
        }
        @keyframes typing {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        .message-bubble {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // THC Products Database
        const productsDB = [
            {
                id: "premo_flower_001",
                name: "Purple Punch",
                brand: "Garden State Dispensary",
                category: "flower",
                strain_type: "indica",
                thc_percentage: 22.5,
                cbd_percentage: 0.5,
                description: "A potent indica strain with sweet grape and blueberry notes. Perfect for evening relaxation and stress relief.",
                price_eighth: 55,
                effects: ["relaxed", "sleepy", "happy", "euphoric", "hungry"],
                terpenes: { myrcene: 1.2, caryophyllene: 0.8, limonene: 0.6 },
                lab_tested: true,
                in_stock: true
            },
            {
                id: "premo_flower_002",
                name: "Sour Diesel",
                brand: "Verano",
                category: "flower",
                strain_type: "sativa",
                thc_percentage: 24.8,
                cbd_percentage: 0.2,
                description: "Energizing sativa with pungent diesel aroma. Great for daytime use and creative activities.",
                price_eighth: 60,
                effects: ["energetic", "uplifted", "creative", "focused", "happy"],
                terpenes: { limonene: 1.5, caryophyllene: 0.9, pinene: 0.7 },
                lab_tested: true,
                in_stock: true
            },
            {
                id: "premo_edible_001",
                name: "Watermelon Gummies",
                brand: "Select",
                category: "edibles",
                strain_type: "hybrid",
                thc_mg: 100,
                description: "Delicious watermelon-flavored gummies. 10 pieces at 10mg THC each. Perfect for precise dosing.",
                price: 25,
                effects: ["relaxed", "happy", "euphoric", "uplifted"],
                lab_tested: true,
                in_stock: true
            },
            {
                id: "premo_vape_001",
                name: "Blue Dream Cartridge",
                brand: "Rhythm",
                category: "vapes",
                strain_type: "hybrid",
                thc_percentage: 85.3,
                description: "Premium distillate cartridge with Blue Dream terpenes. Smooth, balanced effects.",
                price: 45,
                effects: ["creative", "uplifted", "relaxed", "happy", "focused"],
                lab_tested: true,
                in_stock: true
            },
            {
                id: "premo_concentrate_001",
                name: "Wedding Cake Live Resin",
                brand: "Terrascend",
                category: "concentrates",
                strain_type: "indica",
                thc_percentage: 78.5,
                description: "Premium live resin extracted from fresh-frozen Wedding Cake flower.",
                price: 70,
                effects: ["relaxed", "euphoric", "happy", "sleepy", "hungry"],
                lab_tested: true,
                in_stock: true
            }
        ];

        // Sage AI Response Engine
        const getSageResponse = (message) => {
            const lowerMessage = message.toLowerCase();
            
            // Intent detection
            let intent = 'general';
            let products = [];
            let response = '';
            
            // Sleep/Insomnia
            if (lowerMessage.includes('sleep') || lowerMessage.includes('insomnia') || lowerMessage.includes('cant sleep')) {
                intent = 'sleep';
                products = productsDB.filter(p => 
                    p.strain_type === 'indica' && 
                    p.effects.includes('sleepy') || p.effects.includes('relaxed')
                );
                response = "I understand you're looking for help with sleep. Indica strains are typically best for nighttime use. Here are some products that can help promote better sleep:";
            }
            // Pain Relief
            else if (lowerMessage.includes('pain') || lowerMessage.includes('hurt') || lowerMessage.includes('ache')) {
                intent = 'pain';
                products = productsDB.filter(p => 
                    p.strain_type === 'indica' || 
                    (p.thc_percentage && p.thc_percentage > 20)
                );
                response = "For pain management, higher THC products and indica strains are often most effective. These products may help:";
            }
            // Energy/Focus
            else if (lowerMessage.includes('energy') || lowerMessage.includes('focus') || lowerMessage.includes('productive')) {
                intent = 'energy';
                products = productsDB.filter(p => 
                    p.strain_type === 'sativa' && 
                    (p.effects.includes('energetic') || p.effects.includes('focused'))
                );
                response = "Looking to boost energy and focus? Sativa strains are perfect for daytime use. Try these:";
            }
            // Anxiety/Stress
            else if (lowerMessage.includes('anxiety') || lowerMessage.includes('stress') || lowerMessage.includes('calm')) {
                intent = 'anxiety';
                products = productsDB.filter(p => 
                    p.strain_type === 'hybrid' || 
                    p.cbd_percentage > 0
                );
                response = "For anxiety and stress relief, balanced hybrid strains or products with CBD can be helpful. Consider these options:";
            }
            // Edibles specific
            else if (lowerMessage.includes('edible') || lowerMessage.includes('gummies') || lowerMessage.includes('eat')) {
                intent = 'edibles';
                products = productsDB.filter(p => p.category === 'edibles');
                response = "Edibles provide long-lasting effects and precise dosing. Start low and go slow - effects can take 30-90 minutes to begin:";
            }
            // First time
            else if (lowerMessage.includes('first time') || lowerMessage.includes('beginner') || lowerMessage.includes('new to')) {
                intent = 'beginner';
                products = productsDB.filter(p => 
                    (p.thc_percentage && p.thc_percentage < 20) || 
                    p.category === 'edibles'
                );
                response = "Welcome! For beginners, I recommend starting with lower THC products. Here are some gentle options to start with:";
            }
            // General product query
            else if (lowerMessage.includes('product') || lowerMessage.includes('what do you have') || lowerMessage.includes('menu')) {
                intent = 'browse';
                products = productsDB.slice(0, 3);
                response = "Here are some of our popular products available at Premo Cannabis:";
            }
            else {
                response = "I'm here to help you find the perfect cannabis products at Premo Cannabis. What are you looking for today? You can tell me about:\n\n‚Ä¢ How you want to feel (relaxed, energetic, creative)\n‚Ä¢ What you need help with (sleep, pain, anxiety)\n‚Ä¢ Product preferences (flower, edibles, vapes)\n‚Ä¢ Experience level (beginner, experienced)";
                products = [];
            }
            
            return { response, products, intent };
        };

        // Age Verification Component
        const AgeGate = ({ onVerified }) => {
            const [birthDate, setBirthDate] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                const age = Math.floor((new Date() - new Date(birthDate)) / 31557600000);
                
                if (age < 21) {
                    setError('You must be 21 or older to access this content');
                } else {
                    localStorage.setItem('age_verified_sage', 'true');
                    onVerified();
                }
            };

            return (
                <div className="fixed inset-0 bg-gradient-to-br from-green-900 to-green-700 flex items-center justify-center z-50">
                    <div className="bg-white rounded-2xl max-w-md w-full mx-4 p-8 shadow-2xl">
                        <div className="text-center mb-6">
                            <div className="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-4">
                                <i className="fas fa-cannabis text-3xl text-green-600"></i>
                            </div>
                            <h2 className="text-3xl font-bold mb-2">Welcome to Sage AI</h2>
                            <p className="text-gray-600">Powered by Premo Cannabis ‚Ä¢ Keyport, NJ</p>
                            <p className="text-sm text-gray-500 mt-2">Age verification required (21+)</p>
                        </div>
                        
                        <form onSubmit={handleSubmit}>
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                Date of Birth
                            </label>
                            <input
                                type="date"
                                value={birthDate}
                                onChange={(e) => setBirthDate(e.target.value)}
                                max={new Date().toISOString().split('T')[0]}
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-green-500"
                                required
                            />
                            
                            {error && (
                                <div className="bg-red-50 text-red-600 text-sm p-3 rounded-lg mb-4">
                                    <i className="fas fa-exclamation-circle mr-2"></i>{error}
                                </div>
                            )}
                            
                            <button
                                type="submit"
                                className="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-green-800 transition-all"
                            >
                                Verify & Enter
                            </button>
                        </form>
                        
                        <p className="text-xs text-gray-500 text-center mt-6">
                            By entering, you agree to comply with NJ cannabis laws.
                            Cannabis products have not been evaluated by the FDA.
                        </p>
                    </div>
                </div>
            );
        };

        // Product Card Component
        const ProductCard = ({ product }) => {
            const getStrainColor = () => {
                switch (product.strain_type) {
                    case 'indica': return 'bg-purple-100 text-purple-700 border-purple-200';
                    case 'sativa': return 'bg-orange-100 text-orange-700 border-orange-200';
                    default: return 'bg-green-100 text-green-700 border-green-200';
                }
            };

            const formatTHC = () => {
                if (product.thc_percentage) return `${product.thc_percentage}% THC`;
                if (product.thc_mg) return `${product.thc_mg}mg THC`;
                return '';
            };

            const getIcon = () => {
                switch (product.category) {
                    case 'flower': return 'fa-cannabis';
                    case 'edibles': return 'fa-cookie-bite';
                    case 'vapes': return 'fa-wind';
                    case 'concentrates': return 'fa-droplet';
                    default: return 'fa-box';
                }
            };

            return (
                <div className="product-card bg-white rounded-xl shadow-md p-4 mb-3 border border-gray-100">
                    <div className="flex items-start justify-between mb-3">
                        <div className="flex items-start space-x-3">
                            <div className="p-2 bg-green-50 rounded-lg">
                                <i className={`fas ${getIcon()} text-green-600`}></i>
                            </div>
                            <div>
                                <h4 className="font-bold text-gray-900">{product.name}</h4>
                                <p className="text-sm text-gray-600">{product.brand}</p>
                                <div className="flex items-center gap-2 mt-1">
                                    <span className={`px-2 py-0.5 text-xs rounded-full border ${getStrainColor()}`}>
                                        {product.strain_type}
                                    </span>
                                    <span className="text-xs font-semibold text-gray-700">{formatTHC()}</span>
                                </div>
                            </div>
                        </div>
                        <div className="text-right">
                            <p className="text-xl font-bold text-green-600">
                                ${product.price || product.price_eighth}
                            </p>
                            {product.price_eighth && <p className="text-xs text-gray-500">per 1/8 oz</p>}
                        </div>
                    </div>
                    
                    <p className="text-sm text-gray-600 mb-3">{product.description}</p>
                    
                    <div className="flex items-center justify-between">
                        <div className="flex flex-wrap gap-1">
                            {product.effects.slice(0, 3).map((effect, i) => (
                                <span key={i} className="px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded-full">
                                    {effect}
                                </span>
                            ))}
                        </div>
                        <button className="text-sm bg-green-600 text-white px-4 py-1.5 rounded-lg hover:bg-green-700 transition-colors">
                            Add to Cart
                        </button>
                    </div>
                </div>
            );
        };

        // Main Sage Chat Interface
        const SageChat = () => {
            const [messages, setMessages] = useState([
                {
                    type: 'sage',
                    text: "Welcome to Sage AI! I'm your cannabis consultant powered by Premo Cannabis in Keyport, NJ. How can I help you find the perfect product today?",
                    products: []
                }
            ]);
            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleSend = async () => {
                if (!input.trim()) return;

                const userMessage = input;
                setInput('');
                
                // Add user message
                setMessages(prev => [...prev, { type: 'user', text: userMessage }]);
                
                // Show typing indicator
                setIsTyping(true);
                
                // Simulate AI processing time
                setTimeout(() => {
                    const { response, products } = getSageResponse(userMessage);
                    
                    setMessages(prev => [...prev, {
                        type: 'sage',
                        text: response,
                        products: products
                    }]);
                    setIsTyping(false);
                }, 1000);
            };

            const quickActions = [
                { icon: 'fa-moon', text: 'Help me sleep', query: 'I need help sleeping' },
                { icon: 'fa-bolt', text: 'Energy boost', query: 'I need energy and focus' },
                { icon: 'fa-spa', text: 'Reduce anxiety', query: 'Help with anxiety' },
                { icon: 'fa-user', text: "I'm new", query: "I'm a first time user" }
            ];

            return (
                <div className="flex flex-col h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-green-700 to-green-600 text-white p-4 shadow-lg">
                        <div className="container mx-auto flex items-center justify-between">
                            <div>
                                <h1 className="text-2xl font-bold flex items-center">
                                    <i className="fas fa-robot mr-2"></i> Sage AI
                                </h1>
                                <p className="text-sm text-green-100">Cannabis Consultant ‚Ä¢ Powered by Premo Cannabis</p>
                            </div>
                            <div className="text-right">
                                <p className="text-sm">üìç 2 E Front St, Keyport, NJ</p>
                                <p className="text-xs text-green-100">üìû (908) 676-7320</p>
                            </div>
                        </div>
                    </header>

                    {/* Compliance Banner */}
                    <div className="bg-yellow-50 border-b border-yellow-200 px-4 py-2">
                        <p className="text-xs text-center text-yellow-800">
                            <i className="fas fa-info-circle mr-1"></i>
                            NJ Law: 21+ only | Max: 1oz flower, 5g concentrates, 1000mg edibles per day
                        </p>
                    </div>

                    {/* Chat Messages */}
                    <div className="flex-1 overflow-y-auto p-4">
                        <div className="container mx-auto max-w-4xl">
                            {messages.map((msg, index) => (
                                <div key={index} className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'} mb-4 message-bubble`}>
                                    <div className={`max-w-2xl ${msg.type === 'user' ? 'order-1' : ''}`}>
                                        <div className={`rounded-2xl px-4 py-3 ${
                                            msg.type === 'user' 
                                                ? 'bg-green-600 text-white ml-auto' 
                                                : 'bg-white shadow-md'
                                        }`}>
                                            {msg.type === 'sage' && (
                                                <div className="flex items-center mb-2">
                                                    <i className="fas fa-robot text-green-600 mr-2"></i>
                                                    <span className="font-semibold text-gray-700">Sage AI</span>
                                                </div>
                                            )}
                                            <p className={msg.type === 'user' ? 'text-white' : 'text-gray-700'}>
                                                {msg.text}
                                            </p>
                                        </div>
                                        
                                        {msg.products && msg.products.length > 0 && (
                                            <div className="mt-3 space-y-2">
                                                {msg.products.map(product => (
                                                    <ProductCard key={product.id} product={product} />
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                            
                            {isTyping && (
                                <div className="flex justify-start mb-4">
                                    <div className="bg-white shadow-md rounded-2xl px-4 py-3">
                                        <div className="flex items-center">
                                            <i className="fas fa-robot text-green-600 mr-2"></i>
                                            <span className="text-gray-500 typing-indicator">Sage is thinking</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            <div ref={messagesEndRef} />
                        </div>
                    </div>

                    {/* Quick Actions */}
                    {messages.length === 1 && (
                        <div className="container mx-auto max-w-4xl px-4 pb-2">
                            <p className="text-xs text-gray-500 mb-2">Quick questions:</p>
                            <div className="flex flex-wrap gap-2">
                                {quickActions.map((action, i) => (
                                    <button
                                        key={i}
                                        onClick={() => {
                                            setInput(action.query);
                                            handleSend();
                                        }}
                                        className="bg-white border border-gray-200 rounded-full px-4 py-2 text-sm hover:bg-green-50 hover:border-green-300 transition-colors"
                                    >
                                        <i className={`fas ${action.icon} mr-2 text-green-600`}></i>
                                        {action.text}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Input Area */}
                    <div className="border-t bg-white p-4">
                        <div className="container mx-auto max-w-4xl">
                            <div className="flex space-x-2">
                                <input
                                    type="text"
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                                    placeholder="Ask about products, effects, or recommendations..."
                                    className="flex-1 px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500"
                                />
                                <button
                                    onClick={handleSend}
                                    className="bg-green-600 text-white px-6 py-3 rounded-full hover:bg-green-700 transition-colors"
                                >
                                    <i className="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App
        const App = () => {
            const [ageVerified, setAgeVerified] = useState(false);

            useEffect(() => {
                const verified = localStorage.getItem('age_verified_sage');
                if (verified === 'true') {
                    setAgeVerified(true);
                }
            }, []);

            if (!ageVerified) {
                return <AgeGate onVerified={() => setAgeVerified(true)} />;
            }

            return <SageChat />;
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>